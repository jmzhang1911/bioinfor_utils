mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
scale_fill_nejm()
kmeans_res <- kmeans(t(as.matrix(df %>% drop_na())), centers = 6)
results <- as.data.frame(kmeans_res$cluster) %>% rename(cluster = `kmeans_res$cluster`) %>%
rownames_to_column('barcodes') %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-'))
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
scale_fill_nejm()
df %>% rownames_to_column('genes')
df %>% rownames_to_column('genes') %>% View()
View(df2)
View(df)
View(df2)
df %>% rownames_to_column('genes') %>% View()
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
scale_fill_nejm()
geom_density(aes(colour = cluster)) +
theme()
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
scale_fill_nejm() +
geom_density(aes(colour = cluster)) +
theme_classic()
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
scale_fill_nejm() +
theme_classic()
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
labs(y = 'CNV scores') +
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
scale_fill_nejm() +
theme_classic()
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic()
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(axis.text.x = element_text(angle = 45))
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 16),axis.text.x = element_text(angle = 45))
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 16),
axis.text.x = element_text(angle = 45))
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 16),
axis.text.x = element_text(angle = 45), legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 45),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 90),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 45),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 135),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = -45),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = -45, vjust = 1),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = -45, vjust = 1, hjust = 1),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_classic() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_bw() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_bw() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_bw() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 90, vjust = 1, hjust = 0.5),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_bw() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 90, vjust = 0, hjust = 0.5),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_bw() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 90, vjust = 0, hjust = 1),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores') +
scale_fill_nejm() +
theme_bw() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = as.character(cluster)) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores', x = '') +
scale_fill_nejm() +
theme_bw() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = str_c(as.character(cluster)), '_cluster') %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores', x = '') +
scale_fill_nejm() +
theme_bw() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = str_c(as.character(cluster), '_cluster')) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores', x = '') +
scale_fill_nejm() +
theme_bw() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position = 'top')
df %>% rownames_to_column('genes') %>%
pivot_longer(cols = -1, names_to = 'barcodes', values_to = 'expr')  %>%
mutate(barcodes = str_replace_all(barcodes, '\\.', '-')) %>%
group_by(barcodes) %>%
summarise(total = sum(expr ^ 2)) %>%
left_join(results, by = 'barcodes') %>%
mutate(cluster = str_c(as.character(cluster), '_cluster')) %>%
#group_by(cluster) %>%
#summarise(total = sum(expr)) %>%
ggplot(aes(x = cluster, y = total)) +
geom_violin(aes(fill = cluster)) +
labs(y = 'CNV scores', x = '') +
scale_fill_nejm() +
theme_bw() +
theme(text = element_text(size = 18),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
legend.position = 'top') -> p1
ggsave(p1, filename = 'tmp', width = 12, height = 6)
ggsave(p1, filename = 'tmp.png', width = 12)
setwd("~/workspace/mygithub/bioinfor_utils/infercnv")
source('run_infercnv.R')
library(Seurat)
setwd("~/workspace/mygithub/bioinfor_note/spatial_analysis")
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
InstallData("stxBrain")
library(Seurat)
library(SeuratData)
BiocManager::install('SeuratData')
library(dplyr)
InstallData("stxBrain")
library(Seurat)
library(SeuratData)
BiocManager::install('SeuratData')
library('SeuratData')
BiocManager::install('SeuratData')
library(Seurat)
library(SeuratData)
BiocManager::install('SeuratData')
install.packages('SeuratData')
devtools::install_github('satijalab/seurat-data')
devtools::install_github('satijalab/seurat-data')
devtools::install_github('satijalab/seurat-data')
getwd()
devtools::install_local('seuratdta.zip')
library(Seurat)
library(SeuratData)
library(ggplot2)
library(patchwork)
library(dplyr)
InstallData("stxBrain")
InstallData("stxBrain")
InstallData("stxBrain")
getwd()
devtools::install_local('./stxBrain.SeuratData/')
devtools::install_local('./stxBrain.SeuratData_0.1.1.tar.gz')
LoadData('stxBrain.SeuratData/')
InstallData("stxBrain")
InstallData("stxBrain")
InstallData("stxBrain")
LoadData(ds = 'stxBrain.SeuratData/')
InstallData("stxBrain")
edit(InstallData)
install.packages(pkgs = 'stxBrain.SeuratData/')
